{% extends "jepostule/embed/base.html" %}
{% load static %}

{% block "content" %}

{% if form_errors or attachments_form.errors %}
<div data-step="invalid">
    <div class="title"><h1>J'envoie ma candidature</h1></div>
    <div class="step-content center">
        Formulaire invalide, les paramètres suivants comportent des erreurs:

        {{ form_errors }}
        {{ attachments_form.errors }}
    </div>
</div>
{% endif %}

<div data-step="bienvenue">
    <div class="title"><h1>Postuler</h1></div>
    <div class="step-content center">
        <br />
        <br />
        <img src="{% static 'img/icons/envelope.svg' %}" alt="">
        <h2>Bonjour {{ form.cleaned_data.candidate_first_name }} {{ form.cleaned_data.candidate_last_name }}</h2>
        <p>{{ form.cleaned_data.candidate_email }}</p>
        <p>Vous allez postuler à</p>
        <p><b>{{ form.cleaned_data.employer_description }}</b></p>
        <div class="center"><a href="#infos" class="button">Je postule en deux étapes</a></div>
    </div>
</div>

<div data-step="infos">
    <div class="title">
        <h1>Mes coordonnées 
            <div class="step-index">1/2</div><div class="disc">&nbsp;</div>
        </h1>
    </div>
    <div class="step-content">
        <a href="#bienvenue" class="back">retour</a>

        <h2>Vous recherchez un poste de</h2>
        <p>
            <ul data-errors="job"></ul>
            <input type="text" name="job" value="{{ form.cleaned_data.job }}">
        </p>

        <h2>Remplissez vos coordonnées complémentaires</h2>
        <p>
            <label for="candidate_phone">Votre téléphone</label>
            <ul data-errors="candidate_phone"></ul>
            <input type="tel" name="candidate_phone" placeholder="06 12 34 56 78" data-localstorage>
        </p>

        <p>
            <label for="candidate_address">Votre adresse</label>
            <ul data-errors="candidate_address"></ul>
            <input type="text" name="candidate_address" placeholder="7 rue du temple 95130 Ermont" data-localstorage>
        </p>

        <h2>Vous pouvez personnaliser cet email</h2>
        <ul data-errors="message"></ul>
        <textarea name="message">{{ form.cleaned_data.message }}</textarea>

        <div class="center"><a href="#documents" class="button validate-application">Je continue</a></div>
    </div>
</div>

<div data-step="documents">
    <div class="title">
        <h1>Mes pièces jointes
            <div class="step-index">2/2</div><div class="disc">&nbsp;</div>
        </h1>
    </div>
    <div class="step-content">
        <a href="#infos" class="back">retour</a>
        <h2>Vous pouvez joindre des documents à votre candidature (CV, lettre de motivation)</h2>
        <input type="file" name="attachments" class="invisible" 
            multiple accept="video/*,image/*,application/pdf,application/msword,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
        >
        <ul data-errors="attachments"></ul>
        <div class="attachments-list"></div>
        <div class="center">
            <button id="attachments-add" class="one-light-display" data-count="0">Ajouter un document</button>
            <a href="#envoyer" class="button one-display validate-attachments" data-count="0">Je continue</a>
            <a href="#envoyer" class="button button-light zero-display" data-count="0">Je n'ai pas de documents à ajouter</a>
        </div>
    </div>
</div>

<div data-step="envoyer">
    <div class="title"><h1>Récapitulatif</h1></div>
    <div class="step-content">
        <a href="#documents" class="back">retour</a>
        <form action="{% url 'embed:candidater' %}" method="POST" enctype="multipart/form-data">
            {{ form.client_id }}
            {{ form.token }}
            {{ form.timestamp }}
            {{ form.siret }}

            <h2>L'entreprise à laquelle je candidate</h2>
            {{ form.employer_description }}
            {{ form.employer_email }}

            <h2>Le poste recherché</h2>
            <ul data-errors="job"></ul>
            {{ form.job }}
            <p class="modify-link"><a href="#infos">Modifier le poste recherché</a></p>

            <h2>Mes coordonnées</h2>
            <ul data-errors="candidate_address"></ul>
            <ul data-errors="candidate_phone"></ul>
            {{ form.candidate_first_name }} {{ form.candidate_last_name }}
            {{ form.candidate_address }}
            {{ form.candidate_email }}
            {{ form.candidate_phone }}
            <p class="modify-link"><a href="#infos">Modifier mes coordonnées</a></p>

            <h2>Mon email</h2>
            <ul data-errors="message"></ul>
            {{ form.message }}
            <p class="modify-link"><a href="#infos">Modifier mon email</a></p>

            <h2>Mes pièces jointes</h2>
            <ul data-errors="attachments"></ul>
            <div class="attachments-list attachments-no-delete"></div>
            <p class="modify-link"><a href="#documents">Modifier mes pièces jointes</a></p>

            <div class="progressbar" hidden><span></span></div>
            <div class="center"><button type="submit">Je postule</button></div>
        </form>
    </div>
</div>

<div data-step="fin"></div>

<div data-step="erreur">
    <div class="step-content center">
        <h2>Une erreur a eu lieu</h2>
        <p>Ce n'est pas de votre faute, c'est nous :-( Notre équipe technique a été prévenue du problème. Merci de ré-essayer dans quelques heures.</p>
    </div>
</div>

<div data-step="erreur-authentification">
    <div class="step-content center">
        <h2>Une erreur d'authentification a eu lieu</h2>
        <p>Il se peut que vous ayez été déconnecté trop longtemps. Veuillez ré-essayer de postuler en rechargeant la page. Si vous pensez que cette erreur n'est pas normale, merci de contacter l'équipe technique via le lien "Contact".</p>
    </div>
</div>

<script src="{% static 'js/jepostule.js' %}"></script>
{% endblock %}
